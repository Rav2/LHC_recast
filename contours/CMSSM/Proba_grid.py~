import matplotlib.pyplot as plt
import numpy as np
import scipy.stats as st
import cPickle

import os
shit = os.walk("/scratch18/kazuki2/result/Grid2") ## Directorio no q vai fozar
craps = shit.next()
i = 0
x = np.array([])
y = np.array([])
P = np.array([])
f = {}
for crap in craps[2]: ## o terceiro elmento da lista son os arquivos
    if 'ans' in crap: ##marqueinos coa extension ans para identificalos
        names = crap.split("_")
        x0 = float(names[2])
        y0 = float(names[4].replace('.eff', ''))

   #if y0 > 0.:
        x = np.append(x, x0)
        y = np.append(y, y0)
        dc = cPickle.load(file("/scratch18/kazuki2/result/Grid2/"+crap))
        A = 0.
        for i in dc.keys():
             A += dc[i]['chi2_i']
             z = A
   #z = dc['chi2glob']
        P = 1 - st.chi2.cdf(z,7)
        f[(x0,y0)] = P
      

x_new = []
y_new = []

for i in x:
     if i not in x_new:
         x_new.append(i)

for i in y:
    if i not in y_new:
        y_new.append(i)
        
x_new.sort()
y_new.sort()
Prob = np.zeros([len(x_new), len(y_new)])

for i in xrange(len(x_new)):
    for j in xrange(len(y_new)):

        if (x_new[i], y_new[j]) in f:
            Prob[i,j] = f[(x_new[i], y_new[j])]

level = np.arange(0.05, 0.9, 0.15)            

plt.figure(1)
G1 = plt.contour(x_new, y_new, Prob.transpose(), levels = level)
plt.clabel(G1, inline = 1, fontsize = 10)
plt.xlabel('m0 (GeV)')
plt.ylabel('m12 (GeV)')
plt.title('CMSSM ')
plt.axis([0, 2000, 0, 2000])
plt.grid(True)
plt.plot(670, 1040, 'g*', markersize = 25)
plt.show()



q = open('cmssm.txt', 'w')
Pt = Prob.transpose()
#PtPos = ProbPos.transpose()
#PtNeg = ProbNeg.transpose()
for i in xrange(len(x_new)):
     for j in xrange(len(y_new)):
          q.write(str(x_new[i]) + '   ' + str(y_new[j]) + '   ' + str(Pt[j,i])  + ' \n')
  
          
          
